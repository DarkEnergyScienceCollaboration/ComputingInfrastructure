<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>LSST Dark Energy Science Collaboration : Developing DESC Software</title>
  <style type="text/css">code{white-space: pre;}</style>
</head>
<body>
<div id="header">
<h1 class="title">LSST Dark Energy Science Collaboration : Developing DESC Software</h1>
</div>
<p>Welcome! This page contains a growing set of guidelines for people involved in the development of DESC software, which is to say, all of you. We are in the accurate cosmology business, which at the very least means that <em>the systematics introduced by our code must not dominate our dark energy parameter error budget.</em> There's a number of coding practices that we can adopt from the software engineering industry to help us achieve that.</p>
<p>We're lucky to have the DM team to learn from: a useful starting point for DESC development is the <a href="http://developer.lsst.io/en/latest/">DM team's developer guidelines</a>.</p>
<p>A lot of the tips below were introduced and demo'd by Jim Chiang at the SLAC 2016 collaboration meeting, in the Computing Tutorial session. <a href="https://confluence.slac.stanford.edu/download/attachments/206768025/CollabCoding_tutorial.pdf?version=1&amp;modificationDate=1457468188000&amp;api=v2">You can view his slides here</a>, and the <a href="https://www.youtube.com/watch?v=pZSvybTWl-g">video is available on youtube</a>.</p>
<h1 id="using-git-and-github">Using Git and GitHub</h1>
<p>All code should be in <a href="https://github.com/DarkEnergyScienceCollaboration">DESC GitHub</a> repositories. This enables the sharing of code throughout the collaboration, enhances communication, and allows people to work together more easily.</p>
<p>Phil put together a nice FAQ and YouTube tutorial on &quot;<a href="https://github.com/drphilmarshall/GettingStarted#top">Getting Started with Git and GitHub</a>,&quot; aimed at people trying to contribute to GitHub projects. The DM team has a good page on <a href="http://developer.lsst.io/en/latest/tools/git_setup.html">getting started with git and recommended practices</a>.  <a href="http://git-scm.com/book/en/v2">The Pro Git book</a> is good introduction to git.</p>
<h1 id="designing-a-project-repository-organization">Designing a Project: Repository Organization</h1>
<p>Since DESC will be working a lot with LSST Stack code, it make sense to adopt a repository organization that emulates the DM team conventions. Here is the structure of their <a href="https://github.com/lsst/templates">standard package template</a>:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="sourceCode brush:"><code>templates
├── bin.src
│   └── SConscript
├── CopyrightHeader.cc
├── CopyrightHeader.f90
├── CopyrightHeader.py
├── doc
│   ├── doxygen.conf.in
│   └── SConscript
├── examples
│   └── SConscript
├── lib
│   └── SConscript
├── python
│   └── lsst
│       ├── __init__.py
│       └── TMPL
│           ├── __init__.py
│           ├── SConscript
│           └── TMPLLib.i
├── README
├── SConstruct
├── tests
│   └── SConscript
└── ups
    ├── TMPL.build
    ├── TMPL.cfg
    └── TMPL.table</code></pre>
</div>
</div>
<p>This repository structure has several notable features:</p>
<ul>
<li>The <code>bin.src</code> folder is where command line executable scripts should live.  In the setup for this package, this folder would be added to the user's PATH environment variable.</li>
<li>The <code>python</code> folder has an <code>lsst</code> subfolder, which serves as a namespace for LSST Stack code, and would be added to the user's PYTHONPATH.  For DESC, we would likely have a <code>desc</code> folder instead, so that importing code from this package would look like</li>
</ul>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="sourceCode brush:"><code>&gt;&gt;&gt; import desc.TMPL</code></pre>
</div>
</div>
<ul>
<li>There are various <code>SCons</code> build files in some of the folders.  These would be used in building executables, documentation, libraries, <a href="http://www.swig.org/">swig</a>-exposed modules, as well as execute test code when the <code>scons</code> build command is issued.</li>
<li>The <code>ups</code> folder contains files with configuration for the <a href="https://github.com/RobertLuptonTheGood/eups/">eups package management system</a> that the DM team uses.</li>
</ul>
<h1 id="development-tools">Development Tools</h1>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Lint_(software)">Linters</a> and other <a href="https://en.wikipedia.org/wiki/List_of_tools_for_static_code_analysis">static code analysis tools</a>:  Tools such as <a href="https://www.pylint.org/">Pylint</a> and <a href="http://clang-analyzer.llvm.org/">Clang Static Analyzer</a>  will check coding style conventions,but will also check for things like duplicated code, whether interfaces are implemented completely and used consistently, use of deprecated language features, etc..</li>
<li>Editor plugins: The DM team has example configurations for <a href="http://developer.lsst.io/en/latest/tools/emacs.html">emacs</a> and <a href="http://developer.lsst.io/en/latest/tools/vim.html">vim</a> that connect those editors to code-checking tools like Pylint or auto-completion modules like <a href="https://pypi.python.org/pypi/jedi/">jedi</a>.</li>
<li>IDEs: Tools like <a href="https://www.jetbrains.com/pycharm/">PyCharm</a> can be useful as they enable debugging and refactoring and have interfaces to version control and build systems.</li>
<li>DESC will provide template packages (e.g., using <a href="http://cookiecutter.readthedocs.org/en/latest/">cookiecutter</a>) for creating new software projects.</li>
</ul>
<h1 id="coding-style-guidelines">Coding Style Guidelines</h1>
<p>These are specific guidelines for how code should be written. It includes such things as naming conventions for classes, functions, and variables (e.g., when to use CamelCase, etc.), line formatting (indentation and other white-space usage), preferred logic and coding idioms (using the with statement), etc..</p>
<p>For Python, the <a href="http://developer.lsst.io/en/latest/coding/python_style_guide.html">DM style guidelines</a> are essentially the <a href="https://www.python.org/dev/peps/pep-0008/">PEP8 Python Style Guide</a>; while <a href="http://developer.lsst.io/en/latest/coding/cpp_style_guide.html">for C++</a>, they are based on a few industry standard conventions (<a href="https://www.mmarray.org/workinggroups/computing/cppstyle.html">CARMA</a>, <a href="http://geosoft.no/development/cppstyle.html">Geosoft</a>, <a href="https://science.nrao.edu/facilities/alma/aboutALMA/Technology/ALMA_Computing_Memo_Series/0009/2001-06-06.pdf">ALMA</a>).</p>
<p>Some benefits of having a standard coding style:</p>
<ul>
<li>Use of common idioms make the code easier to understand.</li>
<li>Syntactic consistency makes it easier to spot bugs.</li>
<li>New developers have definitive guidance on how to contribute, since adopting a software group's established coding style is a social norm.</li>
</ul>
<h1 id="code-review">Code Review</h1>
<ul>
<li>The aim of code reviews is to have reliable, efficient, maintainable, and well-documented code.</li>
<li>Using linters and static analysis tools to find and fix syntax and other low-level errors before the review frees the code reviewer to concentrate on more substantive aspects like <a href="http://astromemes.tumblr.com/post/51741245212">algorithms and design</a>.</li>
<li>It is more effective to have code reviews occur <em>throughout the development process</em> to ensure that a given package proceeds in a useful direction from the start.</li>
<li>The DM team typically does reviews for code associated with a particular development task such as a bug-fix, a feature request, or an improvement of a specific aspect of the code.</li>
<li>Code review will be essential for &quot;core&quot; code, but it will also be useful for non-core code, especially if that code eventually gets used for a DESC publication or is integrated into the production system.</li>
<li>Who does the reviewing? Your co-developers! Code review is a key part of <a href="https://github.com/features#code-review">collaborative coding</a>
- your teammates are best placed to check your code, to catch new bugs and help foresee future ones. </li>
<li>The DM team has <a href="http://developer.lsst.io/en/latest/processes/workflow.html#review-preparation">a helpful description of their code review process</a>.</li>
</ul>
<h1 id="development-workflows">Development Workflows</h1>
<p>A standard workflow such as <a href="https://guides.github.com/introduction/flow/">GitHub flow</a> enables multiple developers to work on the same package while minimizing conflicts that can arise from concurrent development. Having a standard workflow also gives clear guidance to new developers on how to contribute.</p>
<h1 id="steps-for-github-flow">Steps for GitHub flow</h1>
<ul>
<li>Create a branch off of master. Master should always be deployable (i.e., not broken), so development should occur only on branches.</li>
<li>Add commits to keep track of work done on the branch. Commits should be fairly atomic (that is, small and indivisible), and commit messages should summarize the content of the change. Code checking tools should be used before making a commit.</li>
<li>Push to GitHub, in a remote branch (of the same name, for sanity). This could be in your fork, or the base repo if you have push access.</li>
<li>Open a Pull Request. This initiates discussion about changes and can be made at any stage, e.g., to discuss how the development should proceed, or when the code is ready to be reviewed. The PR may also trigger the CI tools to do a build and run the tests. </li>
<li>Discuss and Review the code, using the PR thread. Make any changes in response to the review, and commit and push to the branch as before.</li>
<li>Once all the tests pass and the reviewer is satisfied, merge into master.</li>
</ul>
<h1 id="automated-testing">Automated Testing</h1>
<p>Continuous testing is a key means of maintaining software quality. Running tests regularly can significantly reduce development time, as they can catch bugs as soon as they are introduced. In addition, comprehensive tests allow for aggressive <a href="https://en.wikipedia.org/wiki/Code_refactoring">refactoring</a>, which is an important part of agile development for producing high quality code.</p>
<h2 id="unit-tests">Unit Tests</h2>
<p>Testing can occur at several levels: system testing, integration testing, and unit testing. Unit tests are the most granular and operate at the function and class level:</p>
<ul>
<li>Unit tests should ideally be comprehensive, but if not, they should at least <em>cover the parts of the code where the cost of failure is highest</em>.</li>
<li>They should <em>run quickly</em>. It should be as painless as possible to run the unit tests for a package so that they are run often throughout the course of development.</li>
<li><em>If any tests are broken, they should be fixed before any other development proceeds.</em></li>
<li>For any new development, it is recommended to <em>write the test that exercises that development first</em>, before touching production code. (For bugs, this means writing the test that illustrates and localizes that bug first, and keeping it as part of the test suite thereafter.)  This is a key feature of <a href="https://en.wikipedia.org/wiki/Test-driven_development">test-driven development</a> (TDD).  Following TDD practices helps ensure that all of the code is tested.</li>
</ul>
<p>The <a href="http://www.diveintopython.net/">Dive Into Python</a> book has <a href="http://www.diveintopython.net/unit_testing/index.html">a good description of unit testing</a>, and the <a href="http://developer.lsst.io/en/latest/coding/unit_test_policy.html">DM team's unit test policy</a> is also worth looking at.</p>
<h2 id="continuous-integration-tools">Continuous Integration Tools</h2>
<p>Several tools are available for implementing automated testing.  Jenkins and Travis CI are available for use by DESC:</p>
<ul>
<li><a href="https://jenkins-ci.org/">Jenkins</a> is a Java-based CI service. We have an <a href="http://srs.slac.stanford.edu/hudson/">instance running at SLAC</a>, so we can use SLAC resources (disk space, LSST Stack code installations) for building and testing DESC code. This is great for projects that depend on the LSST DM stack and Sims tools.</li>
<li><a href="https://travis-ci.org/">Travis CI</a> is a remotely hosted service that can be easily connected to and configured for a GitHub repo. It's a free service for public repositories, and is great for projects that don't have a lot of dependencies.</li>
</ul>
</body>
</html>
