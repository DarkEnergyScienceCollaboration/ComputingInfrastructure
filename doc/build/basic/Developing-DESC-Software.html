<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>LSST Dark Energy Science Collaboration : Developing DESC Software &mdash; LSST DESC Computing Infrastructure 0.0.0 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="LSST DESC Computing Infrastructure 0.0.0 documentation" href="sphinxDoc.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="sphinxDoc.html">LSST DESC Computing Infrastructure</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <div class="section" id="lsst-dark-energy-science-collaboration-developing-desc-software">
<h1><a class="toc-backref" href="#id1">LSST Dark Energy Science Collaboration : Developing DESC Software</a><a class="headerlink" href="#lsst-dark-energy-science-collaboration-developing-desc-software" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#lsst-dark-energy-science-collaboration-developing-desc-software" id="id1">LSST Dark Energy Science Collaboration : Developing DESC Software</a><ul>
<li><a class="reference internal" href="#using-git-and-github" id="id2">Using Git and GitHub</a></li>
<li><a class="reference internal" href="#designing-a-project-repository-organization" id="id3">Designing a Project: Repository Organization</a></li>
<li><a class="reference internal" href="#development-tools" id="id4">Development Tools</a></li>
<li><a class="reference internal" href="#coding-style-guidelines" id="id5">Coding Style Guidelines</a></li>
<li><a class="reference internal" href="#code-review" id="id6">Code Review</a></li>
<li><a class="reference internal" href="#development-workflows" id="id7">Development Workflows</a></li>
<li><a class="reference internal" href="#steps-for-github-flow" id="id8">Steps for GitHub flow</a></li>
<li><a class="reference internal" href="#automated-testing" id="id9">Automated Testing</a><ul>
<li><a class="reference internal" href="#unit-tests" id="id10">Unit Tests</a></li>
<li><a class="reference internal" href="#continuous-integration-tools" id="id11">Continuous Integration Tools</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<p>Welcome! This page contains a growing set of guidelines for people
involved in the development of DESC software, which is to say, all of
you. We are in the accurate cosmology business, which at the very least
means that <em>the systematics introduced by our code must not dominate our
dark energy parameter error budget.</em> There&#8217;s a number of coding
practices that we can adopt from the software engineering industry to
help us achieve that.</p>
<p>We&#8217;re lucky to have the DM team to learn from: a useful starting point
for DESC development is the&nbsp;<a class="reference external" href="http://developer.lsst.io/en/latest/">DM team&#8217;s developer
guidelines</a>.</p>
<p>A lot of the tips below were introduced and demo&#8217;d by Jim Chiang at the
SLAC 2016 collaboration meeting, in the Computing Tutorial session. <a class="reference external" href="https://confluence.slac.stanford.edu/download/attachments/206768025/CollabCoding_tutorial.pdf?version=1&amp;modificationDate=1457468188000&amp;api=v2">You
can view his slides
here</a>,
and the <a class="reference external" href="https://www.youtube.com/watch?v=pZSvybTWl-g">video is available on youtube</a>.</p>
<div class="section" id="using-git-and-github">
<span id="developingdescsoftware-using-git-and-github"></span><h2><a class="toc-backref" href="#id2">Using Git and GitHub</a><a class="headerlink" href="#using-git-and-github" title="Permalink to this headline">¶</a></h2>
<p>All code should be in&nbsp;<a class="reference external" href="https://github.com/DarkEnergyScienceCollaboration">DESC
GitHub</a>&nbsp;repositories.
This enables the&nbsp;sharing of code throughout the collaboration, enhances
communication,&nbsp;and allows people to work together more easily.</p>
<p>Phil put together a nice FAQ and YouTube tutorial on &#8220;<a class="reference external" href="https://github.com/drphilmarshall/GettingStarted#top">Getting Started
with Git and
GitHub</a>,&#8221; aimed
at people trying to contribute to GitHub projects. The DM team has a
good page on <a class="reference external" href="http://developer.lsst.io/en/latest/tools/git_setup.html">getting started with git and recommended
practices</a>.
&nbsp;<a class="reference external" href="http://git-scm.com/book/en/v2">The Pro Git book</a> is good
introduction to git.</p>
</div>
<div class="section" id="designing-a-project-repository-organization">
<h2><a class="toc-backref" href="#id3">Designing a Project: Repository Organization</a><a class="headerlink" href="#designing-a-project-repository-organization" title="Permalink to this headline">¶</a></h2>
<p>Since DESC will be working a lot with LSST Stack code, it make sense
to&nbsp;adopt a repository organization that emulates the DM team
conventions. Here&nbsp;is the structure of their&nbsp;<a class="reference external" href="https://github.com/lsst/templates">standard package
template</a>:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl"></div></div><p>This repository structure has several notable features:</p>
<ul class="simple">
<li>The&nbsp;<code class="docutils literal"><span class="pre">bin.src</span></code> folder is where command line executable scripts
should live. &nbsp;In the setup for this package, this folder would be
added to the user&#8217;s PATH environment variable.</li>
<li>The&nbsp;<code class="docutils literal"><span class="pre">python</span></code> folder has an&nbsp;<code class="docutils literal"><span class="pre">lsst</span></code> subfolder, which serves
as a namespace for LSST Stack code, and would be added to the user&#8217;s
PYTHONPATH. &nbsp;For DESC, we would likely have a&nbsp;<code class="docutils literal"><span class="pre">desc</span></code> folder
instead, so that importing code from this package would look like</li>
</ul>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl"></div></div><ul class="simple">
<li>There are various&nbsp;<code class="docutils literal"><span class="pre">SCons</span></code> build files in some of the folders.
&nbsp;These would be used in building executables, documentation,
libraries, <a class="reference external" href="http://www.swig.org/">swig</a>-exposed modules, as well
as execute test code when the&nbsp;<code class="docutils literal"><span class="pre">scons</span></code> build command is issued.</li>
<li>The&nbsp;<code class="docutils literal"><span class="pre">ups</span></code> folder contains files with configuration for
the&nbsp;<a class="reference external" href="https://github.com/RobertLuptonTheGood/eups/">eups package management
system</a> that the DM
team uses.</li>
</ul>
</div>
<div class="section" id="development-tools">
<h2><a class="toc-backref" href="#id4">Development Tools</a><a class="headerlink" href="#development-tools" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://en.wikipedia.org/wiki/Lint_(software)">Linters</a> and other
<a class="reference external" href="https://en.wikipedia.org/wiki/List_of_tools_for_static_code_analysis">static code analysis
tools</a>:
&nbsp;Tools such as <a class="reference external" href="https://www.pylint.org/">Pylint</a>&nbsp;and <a class="reference external" href="http://clang-analyzer.llvm.org/">Clang Static
Analyzer</a> &nbsp;will check coding
style conventions,but will also check for things like duplicated
code, whether&nbsp;interfaces are implemented completely and used
consistently, use of&nbsp;deprecated language features, etc..</li>
<li>Editor plugins: The DM team has example configurations for
<a class="reference external" href="http://developer.lsst.io/en/latest/tools/emacs.html">emacs</a>&nbsp;and
<a class="reference external" href="http://developer.lsst.io/en/latest/tools/vim.html">vim</a>&nbsp;that
connect those editors to code-checking tools like Pylint or
auto-completion modules like
<a class="reference external" href="https://pypi.python.org/pypi/jedi/">jedi</a>.</li>
<li>IDEs: Tools like <a class="reference external" href="https://www.jetbrains.com/pycharm/">PyCharm</a> can
be useful as they enable debugging and refactoring and have
interfaces to version control and&nbsp;build systems.</li>
<li>DESC will provide template packages (e.g., using
<a class="reference external" href="http://cookiecutter.readthedocs.org/en/latest/">cookiecutter</a>)
for&nbsp;creating new software projects.</li>
</ul>
</div>
<div class="section" id="coding-style-guidelines">
<h2><a class="toc-backref" href="#id5">Coding Style Guidelines</a><a class="headerlink" href="#coding-style-guidelines" title="Permalink to this headline">¶</a></h2>
<p>These are specific guidelines for how code should be written.
It&nbsp;includes such things as naming conventions for classes, functions,
and&nbsp;variables (e.g., when to use CamelCase, etc.), line
formatting&nbsp;(indentation and other white-space usage), preferred logic
and coding&nbsp;idioms (using the with statement), etc..</p>
<p>For Python, the <a class="reference external" href="http://developer.lsst.io/en/latest/coding/python_style_guide.html">DM style
guidelines</a>
are essentially the&nbsp;<a class="reference external" href="https://www.python.org/dev/peps/pep-0008/">PEP8 Python Style
Guide</a>; while <a class="reference external" href="http://developer.lsst.io/en/latest/coding/cpp_style_guide.html">for
C++</a>,
they are based on a few industry standard&nbsp;conventions
(<a class="reference external" href="https://www.mmarray.org/workinggroups/computing/cppstyle.html">CARMA</a>,
<a class="reference external" href="http://geosoft.no/development/cppstyle.html">Geosoft</a>,
<a class="reference external" href="https://science.nrao.edu/facilities/alma/aboutALMA/Technology/ALMA_Computing_Memo_Series/0009/2001-06-06.pdf">ALMA</a>).</p>
<p>Some benefits of having a standard coding style:</p>
<ul class="simple">
<li>Use of common idioms make the code easier to understand.</li>
<li>Syntactic consistency makes it easier to spot bugs.</li>
<li>New developers have definitive guidance on how to contribute, since
adopting a software group&#8217;s established coding style is a social
norm.</li>
</ul>
</div>
<div class="section" id="code-review">
<h2><a class="toc-backref" href="#id6">Code Review</a><a class="headerlink" href="#code-review" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>The aim of code reviews is to have reliable, efficient,&nbsp;maintainable,
and well-documented code.</li>
<li>Using linters and static analysis tools to find and fix syntax
and&nbsp;other low-level errors before the review frees the code reviewer
to&nbsp;concentrate on more substantive aspects like&nbsp;<a class="reference external" href="http://astromemes.tumblr.com/post/51741245212">algorithms and
design</a>.</li>
<li>It is more effective to have code reviews occur <em>throughout
the&nbsp;development process</em> to ensure that a given package proceeds in
a&nbsp;useful direction from the start.</li>
<li>The DM team typically does reviews for code associated with
a&nbsp;particular development task such as a bug-fix, a feature request,
or&nbsp;an improvement of a specific aspect of the code.</li>
<li>Code review will be essential for &#8220;core&#8221; code, but it will also
be&nbsp;useful for non-core code, especially if that code eventually
gets&nbsp;used for a DESC publication or is integrated into the
production&nbsp;system.</li>
<li>Who does the reviewing? Your co-developers! Code review is a key part
of <a class="reference external" href="https://github.com/features#code-review">collaborative coding</a>
- your teammates are best placed to check your code, to catch new
bugs and help foresee&nbsp;future ones.</li>
<li>The DM team has <a class="reference external" href="http://developer.lsst.io/en/latest/processes/workflow.html#review-preparation">a helpful description of their code review
process</a>.</li>
</ul>
</div>
<div class="section" id="development-workflows">
<h2><a class="toc-backref" href="#id7">Development Workflows</a><a class="headerlink" href="#development-workflows" title="Permalink to this headline">¶</a></h2>
<p>A standard workflow such as&nbsp;<a class="reference external" href="https://guides.github.com/introduction/flow/">GitHub
flow</a> enables multiple
developers to&nbsp;work on the same package while minimizing conflicts that
can arise&nbsp;from concurrent development. Having a standard workflow also
gives&nbsp;clear guidance to new developers on how to contribute.</p>
</div>
<div class="section" id="steps-for-github-flow">
<span id="developingdescsoftware-stepsforgithubflow"></span><h2><a class="toc-backref" href="#id8">Steps for GitHub flow</a><a class="headerlink" href="#steps-for-github-flow" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Create a branch off of master. Master should always be deployable
(i.e., not broken),&nbsp;so development should occur only on branches.</li>
<li>Add commits to keep track of work done on the branch. Commits&nbsp;should
be fairly atomic (that is, small and indivisible), and commit
messages should summarize the&nbsp;content of the change. Code checking
tools should be used before&nbsp;making a commit.</li>
<li>Push to GitHub, in a remote branch (of the same name, for sanity).
This could be in your fork, or the base repo if you have push access.</li>
<li>Open a Pull Request. This initiates discussion about changes and&nbsp;can
be made at any stage, e.g., to discuss how the development&nbsp;should
proceed, or when the code is ready to be reviewed. The PR&nbsp;may also
trigger the CI tools to do a build and run the tests.</li>
<li>Discuss and Review the code, using the PR thread. Make any changes in
response to the&nbsp;review, and commit and push to the branch as before.</li>
<li>Once all the tests pass and the reviewer is satisfied, merge
into&nbsp;master.</li>
</ul>
</div>
<div class="section" id="automated-testing">
<h2><a class="toc-backref" href="#id9">Automated Testing</a><a class="headerlink" href="#automated-testing" title="Permalink to this headline">¶</a></h2>
<p>Continuous testing is a key means of maintaining software
quality.&nbsp;Running tests regularly can significantly reduce development
time, as&nbsp;they can catch bugs as soon as they are introduced. In
addition,&nbsp;comprehensive tests allow for aggressive
<a class="reference external" href="https://en.wikipedia.org/wiki/Code_refactoring">refactoring</a>, which
is an&nbsp;important part of agile development for producing high quality
code.</p>
<div class="section" id="unit-tests">
<h3><a class="toc-backref" href="#id10">Unit Tests</a><a class="headerlink" href="#unit-tests" title="Permalink to this headline">¶</a></h3>
<p>Testing can occur at several levels: system testing,
integration&nbsp;testing, and unit testing. Unit tests are the most granular
and&nbsp;operate at the function and class level:</p>
<ul class="simple">
<li>Unit tests should ideally be comprehensive, but if not, they should
at least <em>cover the parts of the code where the cost of failure is
highest</em>.</li>
<li>They should <em>run quickly</em>. It should be as painless as possible
to&nbsp;run the unit tests for a package so that they are run
often&nbsp;throughout the course of development.</li>
<li><em>If any tests are broken, they should be fixed before any
other&nbsp;development proceeds.</em></li>
<li>For any new development, it is recommended to <em>write the test
that&nbsp;exercises that development first</em>, before touching production
code. (For bugs, this means writing the test that illustrates
and&nbsp;localizes that bug first, and keeping it as part of the test
suite&nbsp;thereafter.)&nbsp; This is a key feature of <a class="reference external" href="https://en.wikipedia.org/wiki/Test-driven_development">test-driven
development</a>
(TDD).&nbsp; Following TDD practices helps ensure that all of the code is
tested.</li>
</ul>
<p>The&nbsp;<a class="reference external" href="http://www.diveintopython.net/">Dive Into Python</a>&nbsp;book
has&nbsp;<a class="reference external" href="http://www.diveintopython.net/unit_testing/index.html">a good description of unit
testing</a>, and
the&nbsp;<a class="reference external" href="http://developer.lsst.io/en/latest/coding/unit_test_policy.html">DM team&#8217;s unit test
policy</a>&nbsp;is
also worth looking at.</p>
</div>
<div class="section" id="continuous-integration-tools">
<h3><a class="toc-backref" href="#id11">Continuous Integration Tools</a><a class="headerlink" href="#continuous-integration-tools" title="Permalink to this headline">¶</a></h3>
<p>Several tools are available for implementing automated testing. &nbsp;Jenkins
and Travis CI are available for use by DESC:</p>
<ul class="simple">
<li><a class="reference external" href="https://jenkins-ci.org/">Jenkins</a>&nbsp;is a Java-based CI service. We
have an <a class="reference external" href="http://srs.slac.stanford.edu/hudson/">instance running
at&nbsp;SLAC</a>, so we can use
SLAC resources (disk space, LSST Stack code&nbsp;installations) for
building and testing DESC code. This is great for projects that
depend on the LSST DM stack and Sims tools.</li>
<li><a class="reference external" href="https://travis-ci.org/">Travis CI</a>&nbsp;is a remotely hosted service
that can be easily connected&nbsp;to and configured for a GitHub repo.
It&#8217;s a free service for public&nbsp;repositories, and is great for
projects that don&#8217;t have a lot of dependencies.</li>
</ul>
</div>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="sphinxDoc.html">LSST DESC Computing Infrastructure</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    </div>
  </body>
</html>